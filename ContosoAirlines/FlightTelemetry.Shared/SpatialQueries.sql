-- http://www.birdtheme.org/useful/v3largemap.html
-- https://dev.to/willvelida/working-with-the-azure-cosmos-db-change-feed-processor-in-c-4j3g


DECLARE @UsaWkt varchar(max) =
(SELECT BulkColumn FROM OPENROWSET(BULK 'C:\Projects\Pluralsight\Cosmos DB Change Feed Course\Code\Module05-Notifications\FlightTelemetryGenerator\MapData\usa-wkt.txt', SINGLE_BLOB) AS x)
SET @UsaWkt = SUBSTRING(@UsaWkt, 4, DATALENGTH(@UsaWkt) - 4)

DECLARE @NycWkt varchar(max) =
(SELECT BulkColumn FROM OPENROWSET(BULK 'C:\Projects\Pluralsight\Cosmos DB Change Feed Course\Code\Module05-Notifications\FlightTelemetryGenerator\MapData\nyc-wkt.txt', SINGLE_BLOB) AS x)
SET @NycWkt = SUBSTRING(@NycWkt, 4, DATALENGTH(@NycWkt) - 4)

DECLARE @Airport geometry = 'GEOMETRYCOLLECTION(
	POINT(-122.2961 47.4436),
	POINT(-73.7781 40.6413),
	POINT(-81.3081 28.4312),
	POINT(-118.4085 33.9416),
	POINT(-87.9073 41.9742),
	POINT(-104.6737 39.8561)
)'

DECLARE @Usa geometry = @UsaWkt
DECLARE @Nyc geometry = @NycWkt

SELECT @Usa UNION ALL SELECT @Nyc UNION ALL SELECT @Airport.STBuffer(1)



-- Cosmos
SELECT c.ts, COUNT(c.ts) FROM c GROUP BY c.timestamp
SELECT c.isInNoFlyZone, COUNT(c.isInNoFlyZone) FROM c GROUP BY c.isInUsa
SELECT * FROM c WHERE c.isInNoFlyZone = true
SELECT * FROM c

SELECT * FROM c

SELECT
 c.flightNumber,
 c.arrivalAirport,
 c.departureAirport,
 c.remainingMinutes
FROM
 c



/*
NYC WKT

POLYGON ((
	-74.01326 40.7003  , -73.99884 40.70875 , -73.97893 40.71129 , -73.97121 40.72697 ,
	-73.97387 40.73477 , -73.97142 40.74401 , -73.94205 40.77606 , -73.94414 40.78217 ,
	-73.9396  40.78535 , -73.93622 40.79111 , -73.92938 40.79567 , -73.92905 40.80088 ,
	-73.93481 40.80926 , -73.934   40.81644 , -73.93531 40.83477 , -73.92764 40.84868 ,
	-73.92286 40.85595 , -73.91137 40.86855 , -73.91035 40.87121 , -73.91198 40.87332 ,
	-73.91451 40.87431 , -73.92838 40.86712 , -73.9337  40.85868 , -73.94451 40.84999 ,
	-73.94494 40.84232 , -74.00786 40.75435 , -74.01069 40.72892 , -74.0185  40.70381 ,
	-74.01326 40.7003
))

USA WKT

POLYGON ((
	-123.036495 48.954889, 
	-123.695674 48.140347, 
	-125.014034 48.315996, 
	-124.091182 47.013884, 
	-123.871455 45.494706, 
	-124.706416 42.847685, 
	-124.091182 41.578374, 
	-124.398799 40.451030, 
	-123.915401 39.880136, 
	-123.915401 39.031886, 
	-122.948604 38.035011, 
	-122.421260 37.792321, 
	-122.157588 36.813580, 
	-120.575557 35.034389, 
	-120.575557 34.492870, 
	-119.608760 34.420399, 
	-118.466182 33.801867, 
	-117.894893 33.399238, 
	-117.147823 32.773311, 
	-114.862666 32.662392, 
	-111.171260 31.358218, 
	-108.490596 31.358218, 
	-108.534541 31.732730, 
	-106.557002 31.695346, 
	-104.931026 30.604711, 
	-104.623409 29.769034, 
	-103.964229 29.310239, 
	-103.348995 29.003224, 
	-102.689815 29.692713, 
	-101.635127 29.807173, 
	-100.712276 29.271913, 
	-100.448604 28.502375, 
	-99.789424 27.766077, 
	-99.525752 27.532515, 
	-99.262080 26.554021, 
	-98.910518 26.475375, 
	-97.416377 25.804721, 
	-97.152705 25.923351, 
	-97.460323 26.750401, 
	-97.372432 27.688279, 
	-96.625362 28.618169, 
	-94.955440 29.348552, 
	-93.373409 29.807173, 
	-92.230830 29.501657, 
	-91.967159 29.807173, 
	-91.395870 29.348552, 
	-90.473018 29.310239, 
	-89.286495 29.233572, 
	-89.638057 30.035700, 
	-88.275752 30.566880, 
	-87.748409 30.339584, 
	-86.693721 30.453298, 
	-85.287471 29.692713, 
	-84.232784 30.187759, 
	-82.958370 29.195216, 
	-82.650752 28.733835, 
	-82.826534 28.231697, 
	-82.431026 26.946442, 
	-82.123409 26.789636, 
	-81.903682 26.002372, 
	-81.288448 25.527456, 
	-81.200557 25.170029, 
	-80.453487 25.289288, 
	-80.189815 25.844278, 
	-80.014034 26.632614, 
	-80.673213 28.347786, 
	-80.409541 28.695294, 
	-81.376338 30.869115, 
	-81.244502 31.807452, 
	-79.223018 33.068420, 
	-78.695674 33.947810, 
	-77.992549 33.984257, 
	-76.454463 34.926370, 
	-76.806026 35.393423, 
	-76.190791 35.357591, 
	-75.751338 36.000126, 
	-75.927120 36.883912, 
	-75.971065 37.304543, 
	-75.092159 38.792527, 
	-74.301143 39.236408, 
	-74.037471 40.484462, 
	-71.928096 41.017114, 
	-72.938838 41.116511, 
	-70.741573 41.644087, 
	-70.082393 41.578374, 
	-70.082393 41.906270, 
	-70.653682 42.102203, 
	-70.214229 43.743228, 
	-69.467159 43.965052, 
	-69.027705 44.437610, 
	-68.588252 44.406224, 
	-67.006221 44.750543, 
	-67.225948 45.278661, 
	-67.489620 45.371353, 
	-67.489620 45.679230, 
	-67.885127 45.801910, 
	-67.797237 47.043838, 
	-68.280635 47.372228, 
	-68.895870 47.253048, 
	-69.115596 47.491138, 
	-70.038448 46.713414, 
	-70.038448 46.441554, 
	-70.214229 46.289931, 
	-70.214229 45.924319, 
	-70.873409 45.402217, 
	-71.444698 45.371353, 
	-71.444698 45.123838, 
	-75.004268 45.030742, 
	-76.893916 43.711471, 
	-79.003291 43.520579, 
	-79.003291 42.976427, 
	-82.562862 41.742531, 
	-83.002315 42.394971, 
	-82.606807 42.879895, 
	-82.211299 43.520579, 
	-82.606807 45.433063, 
	-83.485713 45.832537, 
	-83.529659 46.107428, 
	-84.188838 46.137887, 
	-84.408565 46.653119, 
	-85.287471 46.863859, 
	-88.451534 48.286763, 
	-89.638057 48.052296, 
	-90.648799 48.081663, 
	-90.868526 48.257513, 
	-91.527705 48.111013, 
	-92.230830 48.403594, 
	-92.406612 48.286763, 
	-93.461299 48.665486, 
	-93.900752 48.549257, 
	-94.647823 48.781448, 
	-95.263057 49.414463, 
	-95.350948 49.041385, 
	-123.036495 48.954889 
))

*/
